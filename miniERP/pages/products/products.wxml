<view class="container">
  <!-- 搜索和筛选栏 -->
  <view class="search-filter-bar">
    <view class="search-container">
      <view class="search-input-container">
        <image class="search-icon" src="../../images/search.png" mode="aspectFit" />
        <input 
          class="search-input" 
          placeholder="搜索产品名称或编号" 
          value="{{searchKeyword}}"
          bindinput="onSearchInput"
          confirm-type="search"
        />
        <image 
          wx:if="{{searchKeyword}}" 
          class="clear-icon" 
          src="../../images/clear.png" 
          mode="aspectFit" 
          bindtap="clearSearch"
        />
      </view>
      <button class="add-btn" bindtap="navigateToCreateProduct">
        <image src="../../images/add.png" mode="aspectFit" />
      </button>
    </view>

    <!-- 分类筛选 -->
    <scroll-view class="category-tabs" scroll-x enable-flex>
      <view class="tabs-container">
        <block wx:for="{{categories}}" wx:key="id">
          <view 
            class="tab {{selectedCategory === item.id ? 'active' : ''}}"
            bindtap="onCategoryChange"
            data-category="{{item.id}}"
          >
            {{item.name}}
          </view>
        </block>
      </view>
    </scroll-view>
  </view>

  <!-- 排序栏 -->
  <view class="sort-bar">
    <text class="sort-label">排序:</text>
    <button 
      class="sort-btn {{sortBy === 'name' ? 'active' : ''}}"
      bindtap="onSortChange"
      data-sort-by="name"
    >
      名称 {{sortBy === 'name' ? (sortOrder === 'asc' ? '↑' : '↓') : ''}}
    </button>
    <button 
      class="sort-btn {{sortBy === 'price' ? 'active' : ''}}"
      bindtap="onSortChange"
      data-sort-by="price"
    >
      价格 {{sortBy === 'price' ? (sortOrder === 'asc' ? '↑' : '↓') : ''}}
    </button>
    <button 
      class="sort-btn {{sortBy === 'stock' ? 'active' : ''}}"
      bindtap="onSortChange"
      data-sort-by="stock"
    >
      库存 {{sortBy === 'stock' ? (sortOrder === 'asc' ? '↑' : '↓') : ''}}
    </button>
  </view>

  <!-- 产品列表 -->
  <scroll-view 
    class="product-list" 
    scroll-y 
    enable-back-to-top
    bindscrolltolower="onReachBottom"
  >
    <view wx:if="{{loading && products.length === 0}}" class="loading">
      <image src="../../images/loading.gif" mode="aspectFit" />
      <text>加载中...</text>
    </view>

    <view wx:elif="{{filteredProducts.length === 0}}" class="empty-state">
      <image src="../../images/empty-products.png" mode="aspectFit" />
      <text class="empty-title">暂无产品</text>
      <text class="empty-desc">点击右上角添加第一个产品</text>
      <button class="empty-btn" bindtap="navigateToCreateProduct">添加产品</button>
    </view>

    <view wx:else class="product-grid">
      <block wx:for="{{filteredProducts}}" wx:key="id">
        <view class="product-card" bindtap="navigateToProductDetail" data-id="{{item.id}}">
          <view class="product-image-container">
            <image 
              wx:if="{{item.images && item.images[0]}}" 
              src="{{item.images[0]}}" 
              mode="aspectFill" 
              class="product-image"
            />
            <view wx:else class="image-placeholder">
              <image src="../../images/product-default.png" mode="aspectFit" />
            </view>
          </view>

          <view class="product-info">
            <view class="product-name">{{item.name}}</view>
            <view class="product-code">{{item.code}}</view>
            <view class="product-price">¥{{item.price}}</view>
            <view class="product-stock">库存: {{item.stock}}</view>
            <view wx:if="{{item.stock <= item.lowStockThreshold}}" class="low-stock">库存不足</view>
          </view>
        </view>
      </block>

      <view wx:if="{{loading && products.length > 0}}" class="load-more">
        <image src="../../images/loading.gif" mode="aspectFit" />
        <text>加载更多...</text>
      </view>

      <view wx:if="{{!hasMore && products.length > 0}}" class="no-more">
        <text>没有更多了</text>
      </view>
    </view>
  </scroll-view>
</view>